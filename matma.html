<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M·∫≠t M√£ Th√°m T·ª≠ V13: ƒêi·ªÉm T·ª± ƒê·ªông & N√∫t B·ªè Qua</title>
    
    <script>
        window.MathJax = {
            tex: { 
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$']]
            },
            startup: { typeset: false }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { 
            font-family: 'Arial', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start; 
            min-height: 100vh; 
            background-color: #282c34; 
            padding: 10px 10px 20px 10px;
            color: #fff; 
            overflow-y: auto;
        }

        h1 { color: #f1c40f; margin-bottom: 5px; font-size: 1.8em;}

        /* KHUNG CHUNG C·ª¶A C√ÅC ƒê·ªòI */
        #game-wrapper {
            width: 98%; 
            max-width: 1400px; 
            margin-top: 10px;
        }
        
        /* KHU V·ª∞C CH·ª®A N√öT T·ªîNG K·∫æT (LU√îN HI·ªÇN TH·ªä) */
        #control-area {
            text-align: center;
            margin-bottom: 15px;
        }
        #conclusionButton {
            padding: 10px 20px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            background-color: #e67e22; 
            color: white;
            border: none;
            border-radius: 8px;
            transition: background-color 0.2s;
            display: block; 
        }
        #conclusionButton:hover {
            background-color: #d35400;
        }

        /* KHUNG H√ÄNG C·ª¶A M·ªòT ƒê·ªòI */
        .team-row {
            display: flex;
            align-items: stretch;
            margin-bottom: 10px;
            padding: 0;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            border: 2px solid transparent;
            min-height: 100px; 
        }

        /* CSS M√ÄU CHO 5 ƒê·ªòI */
        .team-red { background-color: #e74c3c; border-color: #c0392b; }
        .team-blue { background-color: #3498db; border-color: #2980b9; }
        .team-green { background-color: #2ecc71; border-color: #27ae60; }
        .team-yellow { background-color: #f1c40f; color: #333; border-color: #f39c12; }
        .team-purple { background-color: #9b59b6; border-color: #8e44ad; }
        .team-yellow .team-score-value, .team-yellow .q-text, .team-yellow .manh-moi-status { color: #333; }
        .team-yellow button { color: white; background-color: #e67e22; border: none; }
        .team-yellow button:hover { background-color: #d35400; }
        .team-yellow .input-group input { border: 2px solid #e67e22; }

        /* C·ªòT 1: ƒêI·ªÇM V√Ä ƒêI·ªÄU KHI·ªÇN */
        .team-score-control {
            width: 130px; 
            text-align: center;
            padding: 10px 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-right: 1px solid rgba(255, 255, 255, 0.3);
            flex-shrink: 0;
        }

        .team-score-value { 
            font-size: 2.5em;
            font-weight: 900; 
            margin-bottom: 5px;
        }
        /* N√∫t B·ªé QUA */
        .control-button {
            background: #f39c12; 
            border: none; 
            color: white; 
            padding: 5px 10px;
            margin-top: 5px;
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 0.9em; 
            font-weight: bold; 
            transition: background-color 0.2s;
        }
        .control-button:hover {
            background-color: #e67e22;
        }
        .team-row.finished .control-button {
            display: none;
        }


        /* C·ªòT 2: TR·∫†NG TH√ÅI V√Ä INPUT */
        .team-input-status-area {
            width: 380px;
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-right: 1px solid rgba(255, 255, 255, 0.3);
            flex-shrink: 0;
        }

        .team-status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        /* V√≤ng tr√≤n tr·∫°ng th√°i */
        .manh-moi-status { 
            width: 30px; 
            height: 20px;
            line-height: 20px;
            font-size: 0.8em;
            text-align: center;
            border-radius: 10px; 
            background-color: rgba(0, 0, 0, 0.2);
            font-weight: bold;
            color: white;
            transition: background-color 0.3s, transform 0.3s;
        }
        .manh-moi-completed { background-color: #2ecc71; }
        .manh-moi-active { background-color: #f1c40f; color: #333; }

        .input-group input {
            padding: 8px;
            width: 120px;
            font-size: 1em;
            text-align: center;
            margin-right: 8px;
            color: #333;
            flex-shrink: 0;
        }

        .result-message { 
            margin-top: 5px;
            font-size: 0.9em; 
            font-weight: bold;
        }
        .correct-answer { color: #2ecc71; }
        .incorrect-answer { color: #e74c3c; }
        .skip-penalty { color: #f39c12; }

        /* C·ªòT 3: C√ÇU H·ªéI */
        .team-question-area {
            flex-grow: 1;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .q-number {
            font-size: 1.2em; 
            font-weight: bold;
            margin-bottom: 5px;
        }
        .q-text {
            font-size: 1.4em;
            font-weight: 700;
            line-height: 1.3;
        }
    </style>
</head>
<body>

    <div id="start-area">
        <h1>M·∫¨T M√É TH√ÅM T·ª¨: 5 ƒê·ªòI TRANH T√ÄI</h1>
        <button id="startButton">B·∫ÆT ƒê·∫¶U PHI V·ª§!</button>
    </div>

    <div id="game-wrapper" style="display: none;">
        <div id="control-area">
             <button id="conclusionButton" onclick="showFinalMessage()">T·ªîNG K·∫æT V√Ä C√îNG B·ªê M·∫¨T M√É!</button>
        </div>
        
        <div id="team-rows-container">
            </div>
    </div>

    <div id="final-message">
        <div id="final-message-content">
            <p id="final-message-title"></p>
            <p id="winning-team-name"></p>
            <p style="font-size: 1.5em; margin-top: 20px;">M·∫¨T M√É KHO B√ÅU L√Ä:</p>
            <div id="final-code"></div>
        </div>
    </div>
    
    <script>
        // C·∫§U H√åNH ƒêI·ªÇM V√Ä M·∫¨T M√É
        const SECRET_CODE = ['7', '0', '3', '6', '9', '2', '5'];
        const POINTS_PER_CORRECT = 10;
        const PENALTY_PER_SKIP = 20; // Tr·ª´ 20 ƒëi·ªÉm khi b·ªè qua
        const BONUS_POINTS = 30;

        // D·ªÆ LI·ªÜU 5 B·ªò C√ÇU H·ªéI RI√äNG BI·ªÜT CHO 5 ƒê·ªòI (ƒê√°p √°n ph·∫£i KH·ªöP v·ªõi SECRET_CODE: 7, 0, 3, 6, 9, 2, 5)
        const ALL_TEAM_QUESTIONS = {
            // ƒê·ªôi ƒê·ªè (Index 0)
            red: [
                { q: 'Cho CSC c√≥ $u_1=1$ v√† c√¥ng sai $d=2$. T√¨m $u_4$.', correct: '7' }, 
                { q: 'Cho CSC c√≥ $u_1=10$ v√† $d=-5$. H·ªèi $u_3$ c√≥ gi√° tr·ªã b·∫±ng?', correct: '0' }, 
                { q: 'Cho CSN c√≥ $u_1=1$ v√† c√¥ng b·ªôi $q=3$. T√¨m $u_2$.', correct: '3' }, 
                { q: 'T√¨m $x$ ƒë·ªÉ 3 s·ªë $1, x, 36$ l·∫≠p th√†nh CSN d∆∞∆°ng. $x=$?', correct: '6' }, 
                { q: 'T√¨m t·ªïng $S_3$ c·ªßa CSC c√≥ $u_1=2$ v√† $u_3=4$.', correct: '9' }, 
                { q: 'Cho CSN c√≥ $u_2=10$ v√† $u_3=20$. T√¨m c√¥ng b·ªôi $q$.', correct: '2' }, 
                { q: 'Cho CSC c√≥ $u_5=9$ v√† $d=1$. T√¨m $u_1$.', correct: '5' } 
            ],
            // ƒê·ªôi Xanh (Index 1)
            blue: [
                { q: 'Cho CSC c√≥ $u_1=3$ v√† c√¥ng sai $d=1$. T√¨m $u_5$.', correct: '7' }, 
                { q: 'Cho CSN c√≥ $u_1=4$ v√† $q=0$. T√¨m $u_{10}$.', correct: '0' }, 
                { q: 'Cho CSN c√≥ $u_1=9$ v√† $q=\\frac{1}{3}$. T√¨m $u_2$.', correct: '3' }, 
                { q: 'Cho CSC c√≥ $u_2=4, u_4=8$. T√¨m $u_3$.', correct: '6' }, 
                { q: 'Cho CSC c√≥ $u_1=1$ v√† $d=2$. T√¨m $S_3$.', correct: '9' }, 
                { q: 'T√¨m $u_3$ c·ªßa CSN c√≥ $u_1=8$ v√† $q=\\frac{1}{2}$.', correct: '2' }, 
                { q: 'T√¨m $u_1$ c·ªßa CSC bi·∫øt $u_4=8$ v√† $d=1$.', correct: '5' } 
            ],
            // ƒê·ªôi L√° (Index 2)
            green: [
                { q: 'Cho CSC c√≥ $u_1=10$ v√† $d=-1$. T√¨m $u_4$.', correct: '7' }, 
                { q: 'Cho CSC c√≥ $u_1=0$ v√† $d=5$. T√¨m $u_{10}$.', correct: '0' }, 
                { q: 'T√¨m $x$ ƒë·ªÉ $1, x, 9$ l√† CSN d∆∞∆°ng. $x=$?', correct: '3' }, 
                { q: 'Cho CSN c√≥ $u_2=12$ v√† $u_3=72$. T√¨m c√¥ng b·ªôi $q$.', correct: '6' }, 
                { q: 'T√¨m t·ªïng $S_3$ c·ªßa CSC c√≥ $u_1=1$ v√† $u_3=5$.', correct: '9' }, 
                { q: 'Cho CSC c√≥ $u_3=6$ v√† $u_4=8$. T√¨m $d$.', correct: '2' }, 
                { q: 'T√¨m $u_3$ c·ªßa CSN c√≥ $u_1=25$ v√† $q=\\frac{1}{5}$.', correct: '5' } 
            ],
            // ƒê·ªôi V√†ng (Index 3)
            yellow: [
                { q: 'Cho CSC c√≥ $u_1=7$ v√† $d=0$. T√¨m $u_{100}$.', correct: '7' }, 
                { q: 'Cho CSC c√≥ $u_1=5$ v√† $u_2=5$. T√¨m $d$.', correct: '0' }, 
                { q: 'Cho CSN c√≥ $u_1=1$ v√† $u_3=9$. T√¨m $u_2$ d∆∞∆°ng.', correct: '3' }, 
                { q: 'T√¨m $u_4$ c·ªßa CSC c√≥ $u_1=0$ v√† $d=2$.', correct: '6' }, 
                { q: 'T√¨m $u_2$ c·ªßa CSC c√≥ $u_1=5$ v√† $u_3=13$.', correct: '9' }, 
                { q: 'T√¨m $q$ c·ªßa CSN bi·∫øt $u_1=5$ v√† $u_2=10$.', correct: '2' }, 
                { q: 'T√¨m $u_1$ c·ªßa CSC c√≥ $u_3=9$ v√† $d=2$.', correct: '5' } 
            ],
            // ƒê·ªôi T√≠m (Index 4)
            purple: [
                { q: 'Cho CSN c√≥ $u_1=49$ v√† $q=\\frac{1}{7}$. T√¨m $u_3$.', correct: '7' }, 
                { q: 'Cho CSC c√≥ $u_1=2$ v√† $u_3=2$. T√¨m $d$.', correct: '0' }, 
                { q: 'T√¨m $u_4$ c·ªßa CSC bi·∫øt $u_1=0$ v√† $d=1$.', correct: '3' }, 
                { q: 'T√¨m $x$ ƒë·ªÉ 3 s·ªë $2, x, 18$ l·∫≠p th√†nh CSN d∆∞∆°ng. $x=$?', correct: '6' }, 
                { q: 'T√¨m $u_2$ c·ªßa CSC c√≥ $u_1=20$ v√† $u_3=-2$.', correct: '9' }, 
                { q: 'Cho CSN c√≥ $u_3=8$ v√† $u_4=16$. T√¨m c√¥ng b·ªôi $q$.', correct: '2' }, 
                { q: 'Cho CSC c√≥ $u_2=7$ v√† $d=2$. T√¨m $u_1$.', correct: '5' } 
            ]
        };
        
        // D·ªØ li·ªáu 5 ƒê·ªòI CH∆†I
        const teams = [
            { id: 'red', name: 'ƒê·ªôi ƒê·ªè', colorClass: 'team-red', score: 0, currentManhMoiIndex: 0, manhMoiCompletedState: new Array(SECRET_CODE.length).fill(false) },
            { id: 'blue', name: 'ƒê·ªôi Xanh', colorClass: 'team-blue', score: 0, currentManhMoiIndex: 0, manhMoiCompletedState: new Array(SECRET_CODE.length).fill(false) },
            { id: 'green', name: 'ƒê·ªôi L√°', colorClass: 'team-green', score: 0, currentManhMoiIndex: 0, manhMoiCompletedState: new Array(SECRET_CODE.length).fill(false) },
            { id: 'yellow', name: 'ƒê·ªôi V√†ng', colorClass: 'team-yellow', score: 0, currentManhMoiIndex: 0, manhMoiCompletedState: new Array(SECRET_CODE.length).fill(false) },
            { id: 'purple', name: 'ƒê·ªôi T√≠m', colorClass: 'team-purple', score: 0, currentManhMoiIndex: 0, manhMoiCompletedState: new Array(SECRET_CODE.length).fill(false) }, 
        ];
        
        // BI·∫æN TO√ÄN C·ª§C M·ªöI
        let firstWinningTeam = null; 
        
        // DOM Elements
        const startButton = document.getElementById('startButton');
        const gameWrapper = document.getElementById('game-wrapper');
        const startArea = document.getElementById('start-area');
        const teamRowsContainer = document.getElementById('team-rows-container');
        const finalMessage = document.getElementById('final-message');
        const finalMessageTitleElement = document.getElementById('final-message-title');
        const finalCodeDisplay = document.getElementById('final-code');
        const winningTeamNameElement = document.getElementById('winning-team-name');
        
        // ---------------------------------------------------
        // CH·ª®C NƒÇNG B·∫¢NG ƒêI·ªÇM & ƒêI·ªÄU KHI·ªÇN
        // ---------------------------------------------------
        
        // C·∫≠p nh·∫≠t ƒëi·ªÉm v√† hi·ªáu ·ª©ng
        function updateTeamScore(teamId, delta) {
            const team = teams.find(t => t.id === teamId);
            if (team) {
                team.score += delta;
                const scoreElement = document.getElementById(`score-${teamId}`);
                if (scoreElement) {
                    scoreElement.textContent = team.score;
                    // Hi·ªáu ·ª©ng nh·∫•p nh√°y
                    scoreElement.style.transition = 'none';
                    scoreElement.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        scoreElement.style.transition = 'transform 0.2s';
                        scoreElement.style.transform = 'scale(1.0)';
                    }, 50);
                }
            }
        }
        window.updateTeamScore = updateTeamScore; 
        
        // X·ª≠ l√Ω B·ªé QUA
        window.skipQuestion = function(teamId) {
            const team = teams.find(t => t.id === teamId);
            if (!team || team.currentManhMoiIndex >= SECRET_CODE.length) return;
            
            const qIndex = team.currentManhMoiIndex;
            const resultMessage = document.getElementById(`result-message-${teamId}`);
            
            // 1. Tr·ª´ ƒëi·ªÉm ph·∫°t
            updateTeamScore(teamId, -PENALTY_PER_SKIP);
            
            // 2. C·∫≠p nh·∫≠t tr·∫°ng th√°i v√† chuy·ªÉn c√¢u
            // C√¢u h·ªèi b·ªã B·ªé QUA v·∫´n ƒë√°nh d·∫•u l√† CH∆ØA ho√†n th√†nh (manhMoiCompletedState[qIndex] = false)
            team.currentManhMoiIndex++; 
            
            // 3. Hi·ªÉn th·ªã th√¥ng b√°o
            let msg = `<span class="skip-penalty">B·ªé QUA!</span> -${PENALTY_PER_SKIP} ƒëi·ªÉm. Chuy·ªÉn sang C√¢u ${team.currentManhMoiIndex + 1 || 'K·∫øt th√∫c'}.`;
            resultMessage.innerHTML = msg;
            resultMessage.className = 'result-message skip-penalty';
            
            // 4. Render l·∫°i giao di·ªán
            renderTeamRows();
        }

        // ---------------------------------------------------
        // CH·ª®C NƒÇNG TR√í CH∆†I
        // ---------------------------------------------------
        
        function getTeamQuestion(teamId) {
            const team = teams.find(t => t.id === teamId);
            if (!team || team.currentManhMoiIndex >= SECRET_CODE.length) return null;
            
            const teamQuestions = ALL_TEAM_QUESTIONS[teamId];
            return teamQuestions ? teamQuestions[team.currentManhMoiIndex] : null;
        }

        function renderTeamRows() {
            teamRowsContainer.innerHTML = ''; 
            
            teams.forEach(team => {
                const qIndex = team.currentManhMoiIndex;
                const questionData = getTeamQuestion(team.id); 
                const isGameFinished = qIndex === SECRET_CODE.length;
                
                const row = document.createElement('div');
                row.className = `team-row ${team.colorClass}`;
                row.id = `team-row-${team.id}`;
                
                let questionHTML = '';
                let inputHTML = '';
                
                if (isGameFinished) {
                    row.classList.add('finished');
                    questionHTML = `<div class="q-text">üéâ **HO√ÄN TH√ÄNH 7/7 C√ÇU H·ªéI!** ƒê·ªôi ${team.name} ƒëang ch·ªù gi√°o vi√™n t·ªïng k·∫øt.</div>`;
                    inputHTML = `<div class="result-message correct-answer">T·ªïng ƒëi·ªÉm: ${team.score}</div>`;
                } else if (questionData) {
                    row.classList.remove('finished');
                    questionHTML = `
                        <div class="q-number">C√¢u ${qIndex + 1}</div>
                        <div class="q-text" id="q-text-${team.id}">${questionData.q}</div>
                    `;
                    inputHTML = `
                        <div class="input-group">
                            <input type="number" id="answer-input-${team.id}" placeholder="ƒê√°p √°n (1 ch·ªØ s·ªë)" min="0" max="9" step="1" maxlength="1" oninput="if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">
                            <button onclick="checkTeamAnswer('${team.id}')">KI·ªÇM TRA</button>
                        </div>
                        <div class="result-message" id="result-message-${team.id}"></div>
                    `;
                } else {
                     row.classList.remove('finished');
                     questionHTML = `<div class="q-text">L·ªói d·ªØ li·ªáu c√¢u h·ªèi.</div>`;
                     inputHTML = '';
                }

                // C·∫•u tr√∫c HTML cho m·ªôt h√†ng ƒë·ªôi (3 c·ªôt)
                row.innerHTML = `
                    <div class="team-score-control">
                        <div class="team-score-value" id="score-${team.id}">${team.score}</div>
                        ${!isGameFinished ? `<button class="control-button" onclick="skipQuestion('${team.id}')">B·ªé QUA (-${PENALTY_PER_SKIP})</button>` : ''}
                    </div>
                    <div class="team-input-status-area">
                        <div class="team-status-bar" id="status-bar-${team.id}">
                            </div>
                        ${!isGameFinished && questionData ? inputHTML : `<div style="padding-top: 10px;">${inputHTML}</div>`}
                    </div>
                    <div class="team-question-area">
                        ${questionHTML}
                    </div>
                `;
                
                teamRowsContainer.appendChild(row);
                renderStatusBar(team);
                
                // X·ª≠ l√Ω MathJax cho c√¢u h·ªèi (n·∫øu c√≥)
                if (!isGameFinished && questionData && window.MathJax) {
                    MathJax.typesetPromise([document.getElementById(`q-text-${team.id}`)]);
                }
            });
        }
        
        function renderStatusBar(team) {
            const statusBar = document.getElementById(`status-bar-${team.id}`);
            if (!statusBar) return;
            statusBar.innerHTML = '';
            
            team.manhMoiCompletedState.forEach((isCompleted, index) => {
                const status = document.createElement('div');
                status.className = 'manh-moi-status';
                status.textContent = 'C' + (index + 1); 
                
                if (isCompleted) {
                    status.classList.add('manh-moi-completed');
                } else if (index === team.currentManhMoiIndex) {
                    status.classList.add('manh-moi-active');
                }
                
                statusBar.appendChild(status);
            });
        }
        
        // H√ÄM KI·ªÇM TRA ƒê√ÅP √ÅN CHO T·ª™NG ƒê·ªòI
        window.checkTeamAnswer = function(teamId) {
            const team = teams.find(t => t.id === teamId);
            if (!team || team.currentManhMoiIndex >= SECRET_CODE.length) return;
            
            const qIndex = team.currentManhMoiIndex;
            const questionData = getTeamQuestion(teamId); 
            if (!questionData) return;
            
            const resultMessage = document.getElementById(`result-message-${teamId}`);
            const answerInput = document.getElementById(`answer-input-${teamId}`);
            
            const userAnswer = answerInput.value.trim();
            const correctAnswer = questionData.correct.trim(); 
            
            if (userAnswer.length !== 1 || isNaN(parseInt(userAnswer))) {
                resultMessage.innerHTML = 'ƒê√°p √°n ph·∫£i l√† **m·ªôt ch·ªØ s·ªë** (0-9).';
                resultMessage.className = 'result-message incorrect-answer';
                answerInput.value = ''; 
                return;
            }

            if (userAnswer === correctAnswer) {
                // TR·∫¢ L·ªúI ƒê√öNG
                team.manhMoiCompletedState[qIndex] = true;
                team.currentManhMoiIndex++; 
                
                // T·ª± ƒë·ªông c·ªông ƒëi·ªÉm
                team.score += POINTS_PER_CORRECT;
                
                let msg = `<span class="correct-answer">CH√çNH X√ÅC!</span> +${POINTS_PER_CORRECT} ƒëi·ªÉm. C√¢u ${qIndex + 1} ƒë√£ ƒë∆∞·ª£c m·ªü kh√≥a.`;

                if (team.currentManhMoiIndex === SECRET_CODE.length) {
                     // HO√ÄN TH√ÄNH 7/7
                     team.score += BONUS_POINTS;
                     msg += `<br>üéâ **TH∆Ø·ªûNG L·ªöN!** Ho√†n th√†nh 7/7 C√¢u H·ªèi. (+${BONUS_POINTS} ƒëi·ªÉm)`;
                     
                     // LOGIC: L∆∞u ƒë·ªôi th·∫Øng ƒë·∫ßu ti√™n (n·∫øu ch∆∞a c√≥)
                     if (!firstWinningTeam) {
                        firstWinningTeam = team;
                     }
                }
                
                resultMessage.innerHTML = msg;
                resultMessage.className = 'result-message correct-answer';
                answerInput.value = ''; 
                
                // C·∫≠p nh·∫≠t giao di·ªán to√†n b·ªô game
                updateTeamScore(teamId, 0);
                renderTeamRows(); 

            } else {
                // TR·∫¢ L·ªúI SAI
                answerInput.value = ''; 
                resultMessage.innerHTML = `<span class="incorrect-answer">CH∆ØA CH√çNH X√ÅC!</span> Th·ª≠ l·∫°i.`;
                resultMessage.className = 'result-message incorrect-answer';
            }
        }
        
        // H√ÄM HI·ªÇN TH·ªä K·∫æT QU·∫¢ (G·∫Øn v·ªõi n√∫t T·ªîNG K·∫æT)
        window.showFinalMessage = function() {
            let winningTeam = null;
            let messageTitle = "T·ªîNG K·∫æT THEO ƒêI·ªÇM S·ªê";
            
            if (firstWinningTeam) {
                // Tr∆∞·ªùng h·ª£p 1: C√≥ ƒë·ªôi ho√†n th√†nh 7/7
                winningTeam = firstWinningTeam;
                messageTitle = "CH√öC M·ª™NG ƒê·ªòI ƒê·∫¶U TI√äN GI·∫¢I M√É HO√ÄN TO√ÄN!";
            } else {
                // Tr∆∞·ªùng h·ª£p 2: Ch∆∞a c√≥ ƒë·ªôi n√†o ho√†n th√†nh 7/7 (T·ªïng k·∫øt s·ªõm)
                // T√¨m ƒë·ªôi c√≥ ƒëi·ªÉm cao nh·∫•t
                winningTeam = teams.reduce((max, team) => max.score >= team.score ? max : team, teams[0]);
                
                // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p t·∫•t c·∫£ ƒëi·ªÉm b·∫±ng 0
                if (teams.every(t => t.score === 0)) {
                    messageTitle = "T·ªîNG K·∫æT: CH∆ØA C√ì ƒêI·ªÇM S·ªê N√ÄO ƒê∆Ø·ª¢C GHI";
                    winningTeam = { name: "CH∆ØA X√ÅC ƒê·ªäNH", id: 'default', colorClass: 'team-red', score: 0 }; 
                } else {
                    messageTitle = "T·ªîNG K·∫æT: ƒê·ªòI C√ì ƒêI·ªÇM CAO NH·∫§T";
                }
            }
            
            const finalCodeString = SECRET_CODE.join(' - ');
            
            finalCodeDisplay.textContent = finalCodeString;
            winningTeamNameElement.textContent = winningTeam.name;
            finalMessageTitleElement.textContent = messageTitle;
            
            // L·∫•y m√†u border ƒë·ªÉ t√¥ m√†u t√™n ƒë·ªôi chi·∫øn th·∫Øng
            const teamRow = document.getElementById(`team-row-${winningTeam.id}`);
            if (teamRow) {
                winningTeamNameElement.style.color = window.getComputedStyle(teamRow).borderColor || '#fff176';
            } else {
                winningTeamNameElement.style.color = '#fff176'; 
            }

            // Hi·ªÉn th·ªã khung k·∫øt th√∫c full screen overlay
            finalMessage.style.display = 'flex';
        }

        // H√ÄM B·∫ÆT ƒê·∫¶U GAME
        startButton.addEventListener('click', () => {
            startArea.style.display = 'none';
            gameWrapper.style.display = 'block';
            
            // Reset tr·∫°ng th√°i
            teams.forEach(team => {
                team.score = 0;
                team.currentManhMoiIndex = 0;
                team.manhMoiCompletedState.fill(false);
            });
            firstWinningTeam = null;
            
            renderTeamRows();
        });
    </script>

</body>
</html>
