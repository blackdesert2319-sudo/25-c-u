<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M·∫≠t M√£ R∆∞∆°ng B√°u - GV (·∫®n QR + X√≥a "C√¢u")</title>

<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { fontCache: 'global' }
};
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
body {
  font-family:'Arial',sans-serif;
  background:#1e1e1e;
  color:#fff;
  margin:0;
  padding:0;
  overflow-x:hidden;
}
h1 { color:#f1c40f; margin:12px 0; text-align:center; }
#timer {
  position:fixed;
  top:8px; right:12px;
  font-size:2.2em; font-weight:bold;
  color:#e74c3c; background:#f1c40f;
  padding:4px 12px; border-radius:8px;
  display:none;
  z-index:10;
}
#endEarlyBtn {
  position:fixed;
  top:70px; right:12px;
  font-size:1.1em;
  background:#e67e22;
  color:white;
  border:none;
  border-radius:8px;
  padding:6px 14px;
  font-weight:bold;
  cursor:pointer;
  display:none;
  z-index:10;
}

/* === QR ·ªü giao di·ªán ƒë·∫ßu === */
#qr-list {
  display:flex !important;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  gap:12px;
  margin-top:20px;
}
.qr-item {
  width:180px;
  margin:10px;
  padding:10px;
  border-radius:8px;
  background:white;
  color:#333;
  text-align:center;
  font-weight:bold;
}
.qr-item img {
  width:150px; height:150px;
  border:2px solid #333;
  margin-bottom:5px;
}

/* === GIAO DI·ªÜN 2 === */
#game-wrapper { display:none; position:relative; }
.game-layout {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: flex-start;
  width: 100%;
  margin: 0;
  padding: 0 10px;
  box-sizing: border-box;
}

/* C·ªôt tr√°i: c√°c ƒë·ªôi */
#team-rows-container {
  flex: 1;
  margin-right: 15px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
}

/* C·ªôt ph·∫£i: h√†ng ƒë·ª£i */
#submission-queue-area {
  width: 120px;
  background: #34495e;
  border-radius: 10px;
  padding: 8px;
  height: calc(100vh - 40px);
  overflow-y: auto;
  position: fixed;
  right: 0;
  top: 0;
}
#submission-queue-area h2 {
  font-size: 1em;
  text-align: center;
  color: #f1c40f;
  margin-bottom: 10px;
}

/* === KHUNG M·ªñI ƒê·ªòI === */
.team-row {
  display:flex;
  align-items:center;
  justify-content:flex-start;
  width:100%;
  padding:8px 18px;
  border-radius:10px;
  box-shadow:0 2px 5px rgba(0,0,0,0.4);
  min-height:95px;
}
.team-red{background:#e74c3c;}
.team-blue{background:#3498db;}
.team-green{background:#2ecc71;}
.team-yellow{background:#f1c40f;color:#333;}
.team-purple{background:#9b59b6;}

.team-score-control {
  width:160px;
  display:flex;
  flex-direction:row;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.team-score-value {
  font-size:2.5em;
  font-weight:900;
  background:rgba(255,255,255,0.25);
  padding:2px 12px;
  border-radius:8px;
}
.q-status-item {
  width:36px;
  height:36px;
  border-radius:50%;
  font-size:1.1em;
  font-weight:bold;
  color:white;
  background:#2980b9;
  display:flex;
  justify-content:center;
  align-items:center;
}

.team-question-area {
  flex:1;
  padding-left:20px;
  display:none; /* ·∫©n tr∆∞·ªõc khi start */
}
.q-text {
  font-size:2.3em;
  font-weight:700;
  line-height:1.3;
}

/* H√†ng ƒë·ª£i duy·ªát ƒë√°p √°n */
.submission-item {
  padding:8px;
  margin-bottom:8px;
  background:#2c3e50;
  border-radius:6px;
  display:flex;
  flex-direction:column;
  align-items:center;
  border-left:4px solid #f1c40f;
}
.submission-item b { color:#f1c40f; }
.submission-item button {
  padding:5px 10px;
  background:#e67e22;
  color:white;
  border:none;
  border-radius:5px;
  font-weight:bold;
  margin-top:5px;
  font-size:0.9em;
}

/* START BUTTON */
#startGameBtn {
  position:absolute;
  top:45%;
  left:50%;
  transform:translate(-50%, -50%);
  font-size:2em;
  padding:14px 30px;
  border:none;
  border-radius:10px;
  background:#2ecc71;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  display:none;
  z-index:10;
}

/* OVERLAY K·∫æT TH√öC */
#endOverlay {
  display:none;
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(241,196,15,0.9);
  color:#000;
  z-index:20;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  text-align:center;
}
#endOverlay h1 {
  font-size:3em;
  margin-bottom:20px;
}
#endOverlay .scoreboard {
  font-size:2em;
  line-height:1.5;
  font-weight:bold;
}
</style>
</head>

<body>
  <h1>M·∫¨T M√É R∆Ø∆†NG B√ÅU: 5 ƒê·ªòI TRANH T√ÄI</h1>
  <div id="qr-list"></div>

  <button id="startBtn" onclick="showGame()" style="padding:12px 22px;font-size:1.2em;background:#f1c40f;color:#222;border:none;border-radius:8px;margin:20px;font-weight:bold;cursor:pointer;">
    B·∫ÆT ƒê·∫¶U PHI V·ª§!
  </button>

  <div id="game-wrapper">
    <div id="timer">10:00</div>
    <button id="endEarlyBtn" onclick="endGame()">K·∫æT TH√öC S·ªöM</button>
    <button id="startGameBtn" onclick="startCountdown()">START</button>
    <div class="game-layout">
      <div id="team-rows-container"></div>
      <div id="submission-queue-area">
        <h2>H√ÄNG ƒê·ª¢I DUY·ªÜT ƒê√ÅP √ÅN</h2>
      </div>
    </div>
  </div>

  <div id="endOverlay">
    <h1>üèÜ TR√í CH∆†I K·∫æT TH√öC üèÜ</h1>
    <div class="scoreboard" id="finalScores"></div>
  </div>

<script>
const teams = [
  { name: "ƒê·ªôi ƒê·ªè", color: "team-red", id: "red", score: 0 },
  { name: "ƒê·ªôi Xanh", color: "team-blue", id: "blue", score: 0 },
  { name: "ƒê·ªôi L·ª•c", color: "team-green", id: "green", score: 0 },
  { name: "ƒê·ªôi V√†ng", color: "team-yellow", id: "yellow", score: 0 },
  { name: "ƒê·ªôi T√≠m", color: "team-purple", id: "purple", score: 0 }
];

let timerInterval;
let totalSeconds = 600; // 10 ph√∫t

window.onload = function() {
  const qrList = document.getElementById("qr-list");
  qrList.innerHTML = "";
  const baseURL = location.href.replace(/[^/]*$/, "") + "hs.html";
  teams.forEach(team => {
    const div = document.createElement("div");
    div.className = "qr-item";
    div.innerHTML = `<div>${team.name}</div><div id="qr-${team.id}"></div>`;
    qrList.appendChild(div);
    new QRCode(document.getElementById("qr-" + team.id), {
      text: `${baseURL}?teamId=${team.id}`,
      width: 150,
      height: 150
    });
  });
};

function showGame(){
  // X√≥a ho√†n to√†n ph·∫ßn m√£ QR ƒë·ªÉ gi·∫£i ph√≥ng kh√¥ng gian
  const qrList = document.getElementById("qr-list");
  if (qrList) qrList.remove();

  document.getElementById("startBtn").style.display="none";
  document.getElementById("game-wrapper").style.display="block";
  renderTeams();
  document.getElementById("startGameBtn").style.display="block";
}


function renderTeams(){
  const container = document.getElementById("team-rows-container");
  container.innerHTML = "";
  teams.forEach(team=>{
    const row=document.createElement("div");
    row.className=`team-row ${team.color}`;
    row.innerHTML=`
      <div class="team-score-control">
        <div class="team-score-value" id="score-${team.id}">0</div>
        <div class="q-status-item" id="status-${team.id}">1</div>
      </div>
      <div class="team-question-area" id="qarea-${team.id}">
        <div class="q-text">Cho CSC c√≥ $u_1=3$, $d=2$. T√¨m $u_{10}$.</div>
      </div>
    `;
    container.appendChild(row);
  });
}

function startCountdown(){
  document.getElementById("startGameBtn").style.display="none";
  document.getElementById("timer").style.display="block";
  document.getElementById("endEarlyBtn").style.display="block";
  document.querySelectorAll('.team-question-area').forEach(el=>el.style.display='block');
  MathJax.typeset();
  timerInterval = setInterval(updateTimer,1000);
}

function updateTimer(){
  const min = Math.floor(totalSeconds/60);
  const sec = totalSeconds%60;
  document.getElementById("timer").textContent = `${min}:${sec.toString().padStart(2,'0')}`;
  if(totalSeconds <= 0){
    clearInterval(timerInterval);
    endGame();
  }
  if(totalSeconds <= 10){
    document.getElementById("timer").style.background="#e74c3c";
  }
  totalSeconds--;
}

function endGame(){
  clearInterval(timerInterval);
  document.getElementById("timer").style.display="none";
  document.getElementById("endEarlyBtn").style.display="none";
  const overlay=document.getElementById("endOverlay");
  overlay.style.display="flex";
  let scoreHTML="";
  teams.forEach(t=>{
    const score = document.getElementById(`score-${t.id}`).textContent;
    scoreHTML += `${t.name}: ${score} ƒëi·ªÉm<br>`;
  });
  document.getElementById("finalScores").innerHTML=scoreHTML;
}
</script>
</body>
</html>

