<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M·∫≠t M√£ R∆∞∆°ng B√°u - M√†n H√¨nh GV</title>
<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>

<!-- Firebase SDK (non-module) -->
<script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore-compat.js"></script>
<style>
body {
  font-family:'Arial',sans-serif;
  background:#1e1e1e;
  color:#fff;
  margin:0;
  padding:0;
  overflow-x:hidden;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h1 {
  color:#f1c40f;
  margin:12px 0;
  text-align:center;
}

#timer {
  position:fixed;
  top:8px;
  right:12px;
  font-size:2.2em;
  font-weight:bold;
  color:#e74c3c;
  background:#f1c40f;
  padding:4px 12px;
  border-radius:8px;
  display:none;
}

/* === QR ·ªü giao di·ªán ƒë·∫ßu === */
.qr-item {
  width:180px;
  margin:10px;
  padding:10px;
  border-radius:8px;
  background:white;
  color:#333;
  text-align:center;
  font-weight:bold;
}
.qr-item img {
  width:150px;
  height:150px;
  border:2px solid #333;
  margin-bottom:5px;
}
#qr-list {
  display:flex;
  justify-content:space-around;
  flex-wrap:wrap;
  margin-top:15px;
}

/* === KHUNG M·ªñI ƒê·ªòI === */
.team-row {
  display:flex;
  align-items:center;
  justify-content:space-between;
  width:97%;
  margin:5px 0;
  padding:8px 16px;
  border-radius:10px;
  box-shadow:0 2px 5px rgba(0,0,0,0.4);
  min-height:90px;
}

/* M√†u n·ªÅn t·ª´ng ƒë·ªôi */
.team-red{background:#e74c3c;}
.team-blue{background:#3498db;}
.team-green{background:#2ecc71;}
.team-yellow{background:#f1c40f;color:#333;}
.team-purple{background:#9b59b6;}

/* C·ªôt tr√°i: ƒëi·ªÉm v√† t√™n ƒë·ªôi */
.team-score-control {
  width:100px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.team-score-value {
  font-size:2.5em;
  font-weight:900;
  background:rgba(255,255,255,0.25);
  padding:2px 12px;
  border-radius:8px;
  margin-bottom:3px;
}

/* C·ªôt gi·ªØa: c√¢u h·ªèi */
.team-question-area {
  flex:1;
  padding:0 15px;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.q-number {
  font-weight:bold;
  font-size:1.1em;
  margin-bottom:2px;
}
.q-text {
  font-size:2.1em; /* üí• tƒÉng c·ª° ch·ªØ l·ªõn h∆°n */
  font-weight:700;
  line-height:1.3;
}

/* C·ªôt ph·∫£i: d√£y tr√≤n 1‚Äì7 n·∫±m ngang */
.team-status-area {
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:5px;
}
.q-status-item {
  width:20px; /* nh·ªè g·ªçn h∆°n */
  height:20px;
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:0.75em;
  font-weight:bold;
  color:white;
  background:#7f8c8d;
}
.status-ready { background:#2980b9; }
.status-correct { background:#2ecc71; }

/* H√†ng ƒë·ª£i duy·ªát ƒë√°p √°n */
.submission-item {
  padding:10px;
  margin-bottom:6px;
  background:#2c3e50;
  border-radius:5px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-left:5px solid #f1c40f;
}
.submission-item button {
  padding:6px 12px;
  background:#e67e22;
  color:white;
  border:none;
  border-radius:5px;
  font-weight:bold;
}
#submission-queue-area {
  width:100%;
  max-width:1200px;
  background:#34495e;
  border-radius:10px;
  margin-top:18px;
  padding:12px;
}
</style>


</head>
<body>

<h1>M·∫¨T M√É R∆Ø∆†NG B√ÅU: 5 ƒê·ªòI TRANH T√ÄI</h1>

<!-- GIAO DI·ªÜN 1 -->
<div id="intro-wrapper">
  <h2 style="color:#f1c40f;">QU√âT M√É QR CODE ƒê·ªÇ NH·∫¨P ƒê√ÅP √ÅN</h2>
  <div id="qr-list"></div>
  <button id="transitionButton" style="padding:12px 25px;font-size:1.2em;background:#f39c12;color:white;border:none;border-radius:10px;font-weight:bold;margin-top:20px;">
    B·∫ÆT ƒê·∫¶U PHI V·ª§!
  </button>
</div>

<!-- GIAO DI·ªÜN 2 -->
<div id="game-wrapper" style="display:none;">
  <div id="timer">10:00</div>
  <button onclick="startGame()" style="padding:10px 20px;font-size:1.1em;background:#27ae60;color:white;border:none;border-radius:8px;margin:15px;">B·∫ÆT ƒê·∫¶U ƒê·∫æM GI·ªú</button>
  <div id="submission-queue-area"><h2>H√ÄNG ƒê·ª¢I DUY·ªÜT ƒê√ÅP √ÅN</h2></div>
  <div id="team-rows-container"></div>
</div>

<script>
/* ========== KH·ªûI T·∫†O FIREBASE ========== */
const firebaseConfig = {
  apiKey:"AIzaSyDfcMrblRonAS9Q7BSfD9ZZYeOmSy4UjfQ",
  authDomain:"nutnhap.firebaseapp.com",
  projectId:"nutnhap",
  storageBucket:"nutnhap.firebasestorage.app",
  messagingSenderId:"359344838873",
  appId:"1:359344838873:web:d1746d32920881091c86c8",
  measurementId:"G-0VTTNLWDD9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ========== D·ªÆ LI·ªÜU C√ÅC ƒê·ªòI ========== */
const teams = [
  {id:'red',name:'ƒê·ªôi ƒê·ªè',colorClass:'team-red',score:0,current:0,state:new Array(7).fill(false)},
  {id:'blue',name:'ƒê·ªôi Xanh',colorClass:'team-blue',score:0,current:0,state:new Array(7).fill(false)},
  {id:'green',name:'ƒê·ªôi L√°',colorClass:'team-green',score:0,current:0,state:new Array(7).fill(false)},
  {id:'yellow',name:'ƒê·ªôi V√†ng',colorClass:'team-yellow',score:0,current:0,state:new Array(7).fill(false)},
  {id:'purple',name:'ƒê·ªôi T√≠m',colorClass:'team-purple',score:0,current:0,state:new Array(7).fill(false)}
];

const QUESTIONS = {
  red:[{q:'Cho CSC c√≥ $u_1=3$, $d=2$. T√¨m $u_{10}$.',correct:'21'}],
  blue:[{q:'Cho CSN c√≥ $u_1=3$, $q=2$. T√¨m $u_4$.',correct:'24'}],
  green:[{q:'Cho CSC c√≥ $u_1=5$, $d=4$. T√¨m $u_6$.',correct:'25'}],
  yellow:[{q:'Cho CSC c√≥ $u_1=2$, $d=5$. T√¨m $u_7$.',correct:'32'}],
  purple:[{q:'Cho CSC c√≥ $u_1=3$, $d=4$. T√¨m $u_5$.',correct:'19'}]
};

/* ========== T·∫†O M√É QR ========== */
function generateQRCodes() {
  const BASE = "https://blackdesert2319-sudo.github.io/25-c-u/hs.html";
  const list = document.getElementById('qr-list');
  if (!list) return;
  list.innerHTML = '';
  teams.forEach(t => {
    const url = `${BASE}?teamId=${t.id}`;
    const div = document.createElement('div');
    div.className = 'qr-item';
    div.innerHTML = `<p>${t.name}</p><div id="qr-${t.id}"></div><small>${url}</small>`;
    list.appendChild(div);
    new QRCode(document.getElementById(`qr-${t.id}`), {
      text: url,
      width: 150,
      height: 150
    });
  });
}

/* ========== CHUY·ªÇN GIAO DI·ªÜN ========== */
function transitionToGame() {
  document.getElementById('intro-wrapper').style.display = 'none';
  document.getElementById('game-wrapper').style.display = 'block';
  renderTeams();
}

/* ========== KHI TRANG LOAD XONG ========== */
document.addEventListener('DOMContentLoaded', () => {
  // ƒê·∫£m b·∫£o QRCode script ƒë√£ s·∫µn s√†ng
  if (typeof QRCode === 'undefined') {
    const check = setInterval(() => {
      if (typeof QRCode !== 'undefined') {
        clearInterval(check);
        generateQRCodes();
      }
    }, 200);
  } else generateQRCodes();

  // G√°n s·ª± ki·ªán cho n√∫t
  const btn = document.getElementById('transitionButton');
  if (btn) btn.addEventListener('click', transitionToGame);
});

/* ========== B·∫ÆT ƒê·∫¶U TR√í CH∆†I ========== */
function startGame() {
  document.getElementById('timer').style.display = 'block';
  startTimer();
  listenSubmissions();
}

/* ========== ƒê·ªíNG H·ªí ƒê·∫æM L√ôI ========== */
let timeLeft = 600;
function startTimer() {
  const el = document.getElementById('timer');
  setInterval(() => {
    timeLeft--;
    const m = Math.floor(timeLeft/60), s = timeLeft%60;
    el.textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  }, 1000);
}

/* ========== FIRESTORE L·∫ÆNG NGHE ========== */
function listenSubmissions() {
  db.collection("submissions").orderBy("timestamp","asc").onSnapshot(snap=>{
    const area=document.getElementById('submission-queue-area');
    let html=`<h2>H√ÄNG ƒê·ª¢I DUY·ªÜT ƒê√ÅP √ÅN (${snap.size})</h2>`;
    if(snap.empty) html+='<p>Ch∆∞a c√≥ ƒë·ªôi n√†o g·ª≠i.</p>';
    else snap.forEach(doc=>{
      const d=doc.data();
      html+=`<div class="submission-item"><b>${d.teamId.toUpperCase()}</b>: ${d.answer}
      <button onclick="approve('${doc.id}','${d.teamId}','${d.answer}')">DUY·ªÜT</button></div>`;
    });
    area.innerHTML=html;
  });
}

/* ========== DUY·ªÜT ƒê√ÅP √ÅN ========== */
async function approve(id,teamId,ans){
  const t=teams.find(x=>x.id===teamId);
  if(!t) return;
  const q=t.current;
  const correct=QUESTIONS[teamId][q].correct.toLowerCase();
  if(ans.trim().toLowerCase()===correct){
    t.score+=10; t.state[q]=true; t.current++;
    alert(`${t.name}: Ch√≠nh x√°c! +10 ƒëi·ªÉm`);
  } else alert(`${t.name}: Sai!`);
  await db.collection("submissions").doc(id).delete();
  renderTeams();
}

/* ========== HI·ªÇN TH·ªä B·∫¢NG ƒê·ªòI ========== */
function renderTeams(){
  const c=document.getElementById('team-rows-container');
  c.innerHTML='';
  teams.forEach(t=>{
    const i=t.current;
    const q=i<QUESTIONS[t.id].length?QUESTIONS[t.id][i].q:'ƒê√É HO√ÄN TH√ÄNH';
    const row=document.createElement('div');
    row.className=`team-row ${t.colorClass}`;
    row.innerHTML=`
      <div class="team-score-control"><div class="team-score-value">${t.score}</div>${t.name}</div>
      <div class="team-status-area">${t.state.map((d,idx)=>`<div class="q-status-item ${d?'status-correct':idx===i?'status-ready':''}">${idx+1}</div>`).join('')}</div>
      <div class="team-question-area"><div class="q-number">C√¢u ${i+1}</div><div class="q-text">${q}</div></div>`;
    c.appendChild(row);
  });
}
</script>

</body>
</html>





