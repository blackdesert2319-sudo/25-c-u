<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PH·∫¶N THI TƒÇNG T·ªêC (Ch·∫•m ƒêi·ªÉm ƒê·ªôi + B·∫•m Chu√¥ng)</title>
    
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            startup: { typeset: false }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { font-family: 'Arial', sans-serif; display: flex; align-items: flex-start; justify-content: center; min-height: 100vh; background-color: #282c34; padding: 20px; color: #fff; }
        h1 { color: red; }
        .game-container { background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); width: 90%; max-width: 1050px; color: #333; margin-right: 30px; }
        #score-board-container { width: 250px; padding: 20px; border-radius: 10px; background-color: #3c414d; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); }
        .team-score-item { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; padding: 10px; border-radius: 8px; font-weight: bold; color: white; transition: transform 0.2s; }
        .team-score-item:hover { transform: scale(1.03); }
        .team-name { font-size: 1.1em; }
        .team-score { font-size: 1.8em; }
        .score-control button { background: rgba(255, 255, 255, 0.2); border: none; color: white; padding: 5px 10px; margin-left: 5px; border-radius: 5px; cursor: pointer; font-size: 1em; font-weight: 900; transition: background 0.2s; line-height: 1; }
        .score-control button:hover { background: rgba(255, 255, 255, 0.4); }
        .team-red { background-color: #e74c3c; }
        .team-blue { background-color: #3498db; }
        .team-green { background-color: #2ecc71; }
        .team-yellow { background-color: #f1c40f; color: #333; }
        .team-purple { background-color: #9b59b6; }
        .header { display: flex; justify-content: flex-start; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px; }
        .question-box { margin-bottom: 25px; }
        .question-number { font-size: 2em; color: #2A52BE; margin-bottom: 5px; }
        .question-text { font-size: 2.3em; margin-bottom: 20px; font-weight: 500; }
        .options-container { display: flex; flex-direction: column; gap: 10px; }
        .option { padding: 12px; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; font-size: 2em; }
        .option:hover:not(.disabled) { background-color: #e9e9e9; border-color: #aaa; }
        .option.correct { background-color: #d4edda; border-color: #c3e6cb; }
        .option.incorrect { background-color: #f8d7da; border-color: #f5c6fb; }
        .option.disabled { cursor: default; opacity: 0.6; }
        .button-start { padding: 15px 30px; font-size: 2.2em; cursor: pointer; background-color: #5cb85c; color: white; border: none; border-radius: 8px; transition: background-color 0.2s; }
        .button-start:hover { background-color: #4cae4c; }
        .result-message { margin-top: 15px; font-size: 2.2em; font-weight: bold; }
        .math { font-style: italic; font-weight: 600; }
        #game-content { display: none; }

        /* üîî Ph·∫ßn ƒëi·ªÅu khi·ªÉn b·∫•m chu√¥ng */
        #chuong-area {
            margin-top: 25px;
            background: #222;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        #chuong-status { font-size: 1.6em; color: #ffd700; margin: 15px 0; min-height: 2em; }
        #chuong-start { background-color: #007bff; color: white; }
        #chuong-stop { background-color: #dc3545; color: white; display:none; }
        .foul { color: #ff4444; font-weight: bold; }
    </style>
</head>

<body>

    <div class="game-container">
        <h1>Ch·ªâ ƒë∆∞·ª£c b·∫•m khi n√∫t B·∫§M xu·∫•t hi·ªán, b·∫•m tr∆∞·ªõc s·∫Ω b·ªã lo·∫°i</h1>
        <button id="startButton" class="button-start">V√íNG 1</button>

        <div id="game-content">
            <div class="header"></div>
            <div class="question-box">
                <div class="question-number">C√¢u h·ªèi <span id="current-q-number">1</span>/25</div>
                <div class="question-text" id="question-text"></div>
            </div>

            <div class="options-container" id="options-container">
                <div class="option" data-answer="A">A. <span id="option-a"></span></div>
                <div class="option" data-answer="B">B. <span id="option-b"></span></div>
                <div class="option" data-answer="C">C. <span id="option-c"></span></div>
                <div class="option" data-answer="D">D. <span id="option-d"></span></div>
            </div>

            <div class="result-message" id="result-message"></div>
            <button id="nextQuestionButton" class="button-start" style="display:none; margin-top:20px;">C√¢u h·ªèi ti·∫øp theo >></button>
        </div>

        <div id="final-results" style="display:none; text-align:center; margin-top:30px; color:#333;">
            <h2>K·∫æT TH√öC TR√í CH∆†I!</h2>
            <p style="font-size:1.5em;">ƒê√£ ho√†n th√†nh 25 c√¢u h·ªèi. <br> T·ªïng k·∫øt ƒëi·ªÉm ·ªü b·∫£ng b√™n c·∫°nh.</p>
            <button class="button-start" onclick="location.reload()">Ch∆°i L·∫°i</button>
        </div>
    </div>

    <div id="score-board-container">
        <h2 style="text-align:center; color:#f1c40f;">B·∫£ng ƒêi·ªÉm ƒê·ªôi</h2>
        <div id="score-board"></div>

        <!-- üîî Khu v·ª±c ƒëi·ªÅu khi·ªÉn b·∫•m chu√¥ng -->
        <div id="chuong-area">
            <h2>üîî ƒêI·ªÄU KHI·ªÇN B·∫§M CHU√îNG</h2>
            <div id="chuong-status">‚è≥ ƒêang ch·ªù b·∫Øt ƒë·∫ßu...</div>
            <button id="chuong-start" class="button-start" style="background:#007bff;">B·∫Øt ƒë·∫ßu l∆∞·ª£t b·∫•m</button>
            <button id="chuong-stop" class="button-start" style="background:#dc3545; display:none;">K·∫øt th√∫c l∆∞·ª£t</button>
        </div>
    </div>

     <script>
        const questions = [
            // 15 C√ÇU C∆† B·∫¢N (A)
            { q: 'Cho CSC ($u_n$) c√≥ $u_1 = 5$, $d = -3$. S·ªë h·∫°ng th·ª© t∆∞ $u_4$ l√†:', options: ['4', '-4', '-12', '2'], correct: 'B' },
            { q: 'Cho CSC ($u_n$) c√≥ $u_5 = 18$, $u_{10} = 38$. C√¥ng sai $d$ l√†:', options: ['2', '3', '4', '5'], correct: 'C' },
            { q: 'Cho CSC ($u_n$) c√≥ $u_1 = 2$, $d = 3$. T·ªïng $S_{10}$ l√†:', options: ['155', '310', '150', '95'], correct: 'A' },
            { q: 'CSC ($u_n$) ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·ªüi h·ªá th·ª©c truy h·ªìi n√†o sau ƒë√¢y:', options: ['$u_n = u_{n-1} + n$', '$u_n = u_{n-1} \\cdot 2$', '$u_n = u_{n-1} + 5$', '$u_n = u_1 + (n-1)d$'], correct: 'C' },
            { q: 'Cho CSC ($u_n$) c√≥ $u_1 = 5$, $d = 2$. ƒê·ªÉ t·ªïng $S_n = 480$, s·ªë l∆∞·ª£ng s·ªë h·∫°ng $n$ l√†:', options: ['15', '18', '20', '24'], correct: 'C' },
            { q: 'Cho CSN ($u_n$) c√≥ $u_1 = -4$, $q = 3$. S·ªë h·∫°ng th·ª© nƒÉm $u_5$ l√†:', options: ['-108', '-324', '324', '-400'], correct: 'B' },
            { q: 'C√¥ng th·ª©c t√≠nh t·ªïng $n$ s·ªë h·∫°ng ƒë·∫ßu ti√™n c·ªßa CSC ($u_n$) l√†:', options: ['$S_n = \\frac{n(u_1 + u_n)}{2}$', '$S_n = u_1 \\frac{1 - q^n}{1 - q}$', '$S_n = u_1 + (n-1)d$', '$S_n = n(u_1 + u_n)$'], correct: 'A' },
            { q: 'Cho CSN ($u_n$) c√≥ $u_4 = 54$, $q = 3$. S·ªë h·∫°ng ƒë·∫ßu ti√™n $u_1$ l√†:', options: ['2', '6', '18', '162'], correct: 'A' },
            { q: 'S·ªë h·∫°ng t·ªïng qu√°t $u_n$ c·ªßa m·ªôt CSN ($n \\ge 1$) ƒë∆∞·ª£c x√°c ƒë·ªãnh b·ªüi c√¥ng th·ª©c n√†o:', options: ['$u_n = u_1 + (n-1)q$', '$u_n = u_1 \\cdot q^{n-1}$', '$u_n = u_1 \\cdot q^n$', '$u_n = u_1 \\cdot q + u_{n-1}$'], correct: 'B' },
            { q: 'Cho CSN ($u_n$) c√≥ $u_1 = 2$, $q = -3$. T√≠nh t·ªïng $S_4$:', options: ['-40', '122', '40', '-160'], correct: 'A' },
            { q: 'C√¥ng th·ª©c t√≠nh t·ªïng $n$ s·ªë h·∫°ng ƒë·∫ßu ti√™n c·ªßa CSC theo $u_1$ v√† $d$ l√†:', options: ['$S_n = \\frac{n}{2}[2u_1 + (n-1)d]$', '$S_n = n \\cdot u_n$', '$S_n = \\frac{n}{2}[u_1 + d]$', '$S_n = u_1 \\cdot q^{n-1}$'], correct: 'A' },
            { q: 'C√¥ng th·ª©c t√≠nh t·ªïng $n$ s·ªë h·∫°ng ƒë·∫ßu ti√™n c·ªßa CSN ($q \\ne 1$) l√†:', options: ['$S_n = u_1 (1 - q^n)$', '$S_n = u_1 + u_n$', '$S_n = u_1 \\frac{1 - q^n}{1 - q}$', '$S_n = \\frac{n}{2}[2u_1 + (n-1)q]$'], correct: 'C' },
            { q: 'Cho CSC ($u_n$) c√≥ $u_1 = 10$, $S_{10} = 205$. H√£y t√¨m $u_{10}$:', options: ['31', '21', '41', '35'], correct: 'A' },
            { q: 'Cho CSC ($u_n$) c√≥ $u_1 = -5$, $d = 4$. C√¥ng th·ª©c t√≠nh t·ªïng $S_n$ l√†:', options: ['$S_n = n(2n - 7)$', '$S_n = n(4n - 9)$', '$S_n = 2n^2 - 5n$', '$S_n = n(4n - 10)$'], correct: 'A' },
            { q: 'CSN ($u_n$) ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·ªüi h·ªá th·ª©c truy h·ªìi n√†o sau ƒë√¢y:', options: ['$u_n = u_{n-1} + 3$', '$u_n = u_{n-1} + u_{n-2}$', '$u_n = 2u_{n-1}$', '$u_n = u_1 + 2^{n-1}$'], correct: 'C' },

            // 10 C√ÇU NH·∫¨N DI·ªÜN V√Ä VI·∫æT S·ªê H·∫†NG (B)
            { q: 'D√£y s·ªë n√†o sau ƒë√¢y l√† **c·∫•p s·ªë c·ªông**?', options: ['1; 2; 4; 8', '1; 3; 5; 7', '1; -1; 1; -1', '1; 4; 9; 16'], correct: 'B' },
            { q: 'D√£y s·ªë n√†o sau ƒë√¢y l√† **c·∫•p s·ªë nh√¢n**?', options: ['2; 5; 8; 11', '10; 5; 2.5; 1.25', '1; 1; 2; 3; 5', '1; 3; 5; 7'], correct: 'B' },
            { q: 'Cho CSC ($u_n$) c√≥ $u_1 = 10$, $d = -2$. Ba s·ªë h·∫°ng ƒë·∫ßu ti√™n l√†:', options: ['10; 12; 14', '10; 8; 6', '10; -20; 40', '10; 5; 0'], correct: 'B' },
            { q: 'Cho CSN ($u_n$) c√≥ $u_1 = 16$, $q = 0.5$. Ba s·ªë h·∫°ng ƒë·∫ßu ti√™n l√†:', options: ['16; 8; 4', '16; 16.5; 17', '16; 32; 64', '16; 4; 1'], correct: 'A' },
            { q: 'D√£y s·ªë ($u_n$) v·ªõi $u_n = 3n + 1$. S·ªë h·∫°ng $u_3$ l√†:', options: ['7', '10', '4', '13'], correct: 'B' },
            { q: 'D√£y s·ªë ($u_n$) v·ªõi $u_n = 2^{n+1}$. S·ªë h·∫°ng $u_3$ l√†:', options: ['8', '16', '32', '10'], correct: 'B' },
            { q: 'D√£y s·ªë 5; 5; 5; 5 l√†:', options: ['Ch·ªâ l√† c·∫•p s·ªë c·ªông', 'Ch·ªâ l√† c·∫•p s·ªë nh√¢n', 'V·ª´a l√† CSC, v·ª´a l√† CSN', 'Kh√¥ng ph·∫£i CSC, kh√¥ng ph·∫£i CSN'], correct: 'C' },
            { q: 'Cho CSC ($u_n$) c√≥ $u_1 = 5$. Bi·∫øt $u_3 = 11$. C√¥ng sai $d$ l√†:', options: ['3', '6', '5.5', '1'], correct: 'A' },
            { q: 'Cho CSN ($u_n$) c√≥ $u_1 = 2$. Bi·∫øt $u_3 = 18$ ($q > 0$). C√¥ng b·ªôi $q$ l√†:', options: ['9', '4', '3', '6'], correct: 'C' },
            { q: 'D√£y s·ªë n√†o **kh√¥ng ph·∫£i** CSC c≈©ng **kh√¥ng ph·∫£i** CSN?', options: ['2; 4; 6; 8', '2; 6; 18; 54', '1; 4; 2; 5', '10; 10; 10; 10'], correct: 'C' }
        ];

        let currentQuestionIndex = 0;
        
        const startButton = document.getElementById('startButton');
        const gameContent = document.getElementById('game-content');
        const questionText = document.getElementById('question-text');
        const qNumber = document.getElementById('current-q-number');
        const optionsContainer = document.getElementById('options-container');
        const resultMessage = document.getElementById('result-message');
        const finalResults = document.getElementById('final-results');
        const optionElements = optionsContainer.querySelectorAll('.option');
        const scoreBoardContainer = document.getElementById('score-board-container');
        const nextQuestionButton = document.getElementById('nextQuestionButton');

        // D·ªØ li·ªáu v√† c·∫•u h√¨nh cho 5 ƒë·ªôi
        const teams = [
            { id: 'red', name: 'ƒê·ªôi ƒê·ªè', colorClass: 'team-red', score: 0 },
            { id: 'blue', name: 'ƒê·ªôi Xanh', colorClass: 'team-blue', score: 0 },
            { id: 'green', name: 'ƒê·ªôi L√°', colorClass: 'team-green', score: 0 },
            { id: 'yellow', name: 'ƒê·ªôi V√†ng', colorClass: 'team-yellow', score: 0 },
            { id: 'purple', name: 'ƒê·ªôi T√≠m', colorClass: 'team-purple', score: 0 },
        ];
        
        // G·∫Øn s·ª± ki·ªán cho n√∫t "C√¢u h·ªèi ti·∫øp theo"
        nextQuestionButton.addEventListener('click', () => {
            currentQuestionIndex++;
            loadQuestion();
        });


        // ---------------------------------------------------
        // CH·ª®C NƒÇNG B·∫¢NG ƒêI·ªÇM ƒê·ªòI
        // ---------------------------------------------------

        function updateTeamScore(teamId, delta) {
            const team = teams.find(t => t.id === teamId);
            if (team) {
                team.score += delta;
                document.getElementById(`score-${teamId}`).textContent = team.score;
            }
        }

        function renderScoreBoard() {
            const board = document.getElementById('score-board');
            board.innerHTML = ''; // X√≥a n·ªôi dung c≈©
            
            teams.forEach(team => {
                const item = document.createElement('div');
                item.className = 'team-score-item ' + team.colorClass;
                item.innerHTML = `
                    <div class="team-info">
                        <div class="team-name">${team.name}</div>
                        <div class="team-score" id="score-${team.id}">${team.score}</div>
                    </div>
                    <div class="score-control">
                        <button onclick="updateTeamScore('${team.id}', 10)">+</button>
                        <button onclick="updateTeamScore('${team.id}', -5)">-</button>
                    </div>
                `;
                board.appendChild(item);
            });
            scoreBoardContainer.style.display = 'block';
        }


        // ---------------------------------------------------
        // CH·ª®C NƒÇNG TR√í CH∆†I
        // ---------------------------------------------------
        
        function renderMath() {
            const currentQ = questions[currentQuestionIndex];
            
            questionText.innerHTML = currentQ.q;
            optionElements.forEach((el, index) => {
                el.querySelector('span').innerHTML = currentQ.options[index];
            });

            if (window.MathJax) {
                // X·ª≠ l√Ω c√°c ph·∫ßn t·ª≠ li√™n quan ƒë·∫øn c√¢u h·ªèi hi·ªán t·∫°i
                MathJax.typesetPromise([questionText, optionsContainer]);
            }
        }

        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                endGame();
                return;
            }

            const currentQ = questions[currentQuestionIndex];
            
            // ·∫®n n√∫t "C√¢u h·ªèi ti·∫øp theo"
            nextQuestionButton.style.display = 'none';

            // Reset tr·∫°ng th√°i
            resultMessage.textContent = '';

            // Hi·ªÉn th·ªã s·ªë c√¢u h·ªèi
            qNumber.textContent = currentQuestionIndex + 1;
            
            // C·∫•u h√¨nh c√°c n√∫t ƒë√°p √°n
            optionElements.forEach((el) => {
                el.classList.remove('correct', 'incorrect', 'disabled');
                el.onclick = () => checkAnswer(el, currentQ.correct);
            });
            
            // Y√™u c·∫ßu x·ª≠ l√Ω v√† hi·ªÉn th·ªã c√¥ng th·ª©c to√°n
            renderMath();
        }

        function highlightAndDisableAll(correctAnswer) {
             optionElements.forEach(el => {
                el.classList.add('disabled'); 
                el.onclick = null;
                if (el.getAttribute('data-answer') === correctAnswer) {
                    el.classList.add('correct'); 
                }
            });
            nextQuestionButton.style.display = 'block'; // Hi·ªÉn th·ªã n√∫t chuy·ªÉn c√¢u
        }

        function checkAnswer(selectedElement, correctAnswer) {
            
            const selectedAnswer = selectedElement.getAttribute('data-answer');
            
            if (selectedAnswer === correctAnswer) {
                // TR·∫¢ L·ªúI ƒê√öNG: ƒê√°nh d·∫•u ƒë√∫ng, hi·ªÉn th·ªã th√¥ng b√°o, v√¥ hi·ªáu h√≥a t·∫•t c·∫£
                selectedElement.classList.add('correct');
                resultMessage.innerHTML = 'Ch√≠nh x√°c! **M·ªùi gi√°o vi√™n c·ªông ƒëi·ªÉm cho ƒë·ªôi.**';

                highlightAndDisableAll(correctAnswer);
                
            } else {
                // TR·∫¢ L·ªúI SAI: ƒê√°nh d·∫•u sai, v√¥ hi·ªáu h√≥a ƒë√°p √°n sai, cho ph√©p ch·ªçn ti·∫øp
                selectedElement.classList.add('incorrect');
                selectedElement.classList.add('disabled'); 
                selectedElement.onclick = null; 

                resultMessage.textContent = 'Ch∆∞a ch√≠nh x√°c. Th·ª≠ l·∫°i!';
            }
        }
        
        // H√†m b·∫Øt ƒë·∫ßu game
        startButton.addEventListener('click', () => {
            startButton.style.display = 'none';
            gameContent.style.display = 'block';
            renderScoreBoard(); // Hi·ªán b·∫£ng ƒëi·ªÉm ƒë·ªôi
            loadQuestion();
        });

        function endGame() {
            gameContent.style.display = 'none';
            finalResults.style.display = 'block';
            scoreBoardContainer.style.display = 'block';
        }

        // ƒê∆∞a h√†m updateTeamScore ra global scope ƒë·ªÉ c√°c n√∫t HTML c√≥ th·ªÉ g·ªçi
        window.updateTeamScore = updateTeamScore;
    </script>

    <!-- üîî Firebase cho ph·∫ßn b·∫•m chu√¥ng -->
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-database.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDkVTo1R5-d-m0r2mvNU2Z52r_hSVD9yMM",
        authDomain: "buzzerneonpro.firebaseapp.com",
        databaseURL: "https://buzzerneonpro-default-rtdb.firebaseio.com",
        projectId: "buzzerneonpro",
        storageBucket: "buzzerneonpro.appspot.com",
        messagingSenderId: "1005462275274",
        appId: "1:1005462275274:web:2d509079fb19d519c7c402"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      const statusEl = document.getElementById("chuong-status");
      const btnStart = document.getElementById("chuong-start");
      const btnStop = document.getElementById("chuong-stop");

      btnStart.onclick = () => {
        db.ref("chuong/state").set({ status: "ready", winner: null, foul: null });
        statusEl.textContent = "‚úÖ ƒêang m·ªü, h·ªçc sinh c√≥ th·ªÉ b·∫•m!";
        btnStart.style.display = "none";
        btnStop.style.display = "inline-block";
      };

      btnStop.onclick = () => {
        db.ref("chuong/state/status").set("locked");
        statusEl.textContent = "üîí ƒê√£ k·∫øt th√∫c l∆∞·ª£t b·∫•m.";
        btnStart.style.display = "inline-block";
        btnStop.style.display = "none";
      };

      db.ref("chuong/state").on("value", (snap) => {
        const val = snap.val();
        if (!val) return;
        if (val.winner) {
          statusEl.innerHTML = `üèÅ <b>${val.winner.team}</b> b·∫•m tr∆∞·ªõc l√∫c ${val.winner.time}`;
        }
        if (val.foul) {
          statusEl.innerHTML += `<div class="foul">‚ö†Ô∏è ${val.foul.team} ph·∫°m quy (b·∫•m s·ªõm)</div>`;
        }
      });
    </script>

</body>
</html>
